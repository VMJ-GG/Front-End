<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- CSSs -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.0-beta/css/bootstrap-select.min.css">
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./vendor/css/snappy-light-prettify.css">

    <!-- Scripts -->
    <script type="text/javascript" src="./vendor/js/prettify.js"></script>
    <script type="text/javascript" src="./js/encrypter.js"></script>

    <!-- Material Design Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <title>Crittografia</title>
  </head>
  <body>
    <header class="header-fixed nav-down">
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">WebTips</a>
         <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
         </button>
         <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Reti</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle active" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Algoritmi JS
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="CalcoloNumerico.html">Calcolo Numerico</a>
                 <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="Crittografia.html">Crittografia</a>
              </div>
            </li>
          </ul>
          <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" placeholder="Cerca qualcosa" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Cerca</button>
          </form>
        </div>
      </nav>
    </header>

    <main class="container-fluid px-0" role="main">
      <section id="top" class="jumbotron jumbotron-composti">
        <div class="jumbotron-body">
          <div class="gw-container">
            <input type="text" class="d-none">
            <div class="gw-placeholder">
              <div class="gw-static">
                <span>Inserisci qui</span>
              </div>
              <div class="gw-wrapper">
                <a class="gw-text" data-phrases='[" il testo...", " ciò che vuoi criptare...", " una qualsiasi frase..."]' data-duration="2000"></a>
              </div>
            </div>
          </div>
          <div class="">
            <button type="button" id="buttonCriptDecript" class="mt-5 btn btn-outline-light arrow-right" onclick="ChangeText()"><span>Cripta</span><i class="material-icons">keyboard_arrow_right</i></button>
          </div>
        </div>
      </section>

        <div class="container">
          <div class="row">
            <div class="col-lg-12">
              <div class="caption-head">
                Funzioni composte
              </div>
              <div class="caption-body">
                <div class="text-h5 text-primary arrow-down">
                  Il crittogramma
                </div>
                <div class="border rounded" style=" font-size:1.7rem; height:40px;">
                  <div id="output" class="output" style="white-space: pre"></div>
                </div>
              </div>
              <div class="caption-body mt-4 mb-4" onclick="hideShow(1);">
                Clicca i metodi nell'ordine che preferisci, creando catene crittografiche composte a tuo piacimento. <div class="arrow-down" style="display: inline">
                  <i class="material-icons">keyboard_arrow_down</i>
                </div>
              </div>
             </div>
            </div>

              <div class="row">

                <div class="col-md-4">
                  <div class="caption-head text-primary">
                    I metodi
                  </div>
                  <div class="badge-container border border-primary rounded">
                    <div class="btn btn-outline-primary ml-2 mb-2">Cesare</div>
                    <div class="btn btn-outline-primary ml-2 mb-2">Atbash</div>
                    <div class="btn btn-outline-primary ml-2 mb-2">Vigenère</div>
                    <div class="btn btn-outline-primary ml-2 mb-2">Pizzini</div>
                    <div class="btn btn-outline-primary ml-2 mb-2">Polibio</div>
                    <div class="btn btn-outline-primary ml-2 mb-2">Cesare</div>
                  </div>
                </div>

                <div class="col-md-8">
                  <div class="text-danger caption-head">
                    La tua catena
                  </div>
                  <div id="chain" class="badge-container border border-danger rounded"></div>


                </div>

            </div>

            <hr>
            <div class="row mt-3 mb-5">
              <div class="col-lg-4">
                <div class="">
                  Seleziona in ordine i <div class="text-primary" style="display:inline">metodi</div> che vuoi implementare nel tuo processo di crittografia. I metodi posso ripetersi e non ci sono limiti nel creare combinazioni di cifratura!
                </div>
              </div>
              <div class="col-lg-8">
                <div class="">
                  I metodi verranno visualizzati nella sezione rossa in ordine di esecuzione. Cliccando sopra i metodi che lo consentono, potrai selezionare la chiave di cifratura. <br> Puoi cancellare i metodi che non vuoi più dentro <div class="text-danger" style="display:inline">la tua catena</div>.
                </div>
              </div>
            </div>
        </div>

        <footer>
          <div class="caption footer-container">
            <div class="footer-link arrow-down">
              Back to top
              <i class="material-icons">keyboard_arrow_up</i>
            </div>
          </div>
        </footer>

    </main>


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.0-beta/js/bootstrap-select.min.js"></script>
    <script type="text/javascript" src="./js/helpers.js"></script>
    <script type="text/javascript" src="./js/ghostWriter.js"></script>
    <script type="text/javascript" src="./js/navbarScrolling.js"></script>
    <script type="text/javascript" src="./js/fromCriptToDecript.js"></script>
    <script type="text/javascript" src="./js/hideShow.js"></script>

    <script type="text/javascript">
      var caesar = Encrypter.caesar;
      var atbash = Encrypter.atbash;
      var pizzini = Encrypter.pizzini;
      var polibio = Encrypter.polibio;
      var vigenere = Encrypter.vigenere;

      $(document).ready(function() {
        // Selectors
        var PLACEHOLDER = '.gw-placeholder';

        // Writer object -> It starts typing by default
        var writer = $('.gw-text').ghostWriter();

        // === Event Listeners ===
        // Writer's event
        $(PLACEHOLDER).on('click', function(e) {
          e.stopPropagation();

          var placeholder = $(this);
          var input       = placeholder.prev();
          var inputText   = input.val();

          writer.stop();  // Stop typing
          placeholder
            .addClass('d-none');

          var outputTextPresent = $('[id$="output"]').text() && $('[id$="output"]').text()[0] !== '.';
          input
            .removeClass('d-none')
            .val(outputTextPresent ? inputText : '')
            .focus();
        });

        var output = $('#output');
        var chain = Encrypter.EMPTY;
        $('.badge-container').find('.btn').on('click', function() {
          var value = $(this).text();
          var chain = $('#chain').append(
            '<div class="btn btn-danger composed-badge" data-toggle="tooltip" data-placement="bottom" title="Tooltip Bottom">' + value +
              '<i class="material-icons icon-small ml-1 clear">clear</i>' +
            '</div>'
          )

          chain.find('.clear').on('click', function() {
            var parent = $(this).closest('.composed-badge');
            var value = parent.text();
            chain.remove(value);
            parent.tooltip('dispose');
            parent.remove();
          });

          chain.find('.btn').tooltip({
            trigger: 'click'
          });

          switch (value) {
            case 'Cesare':
              chain.append(caesar);
            break;
            case 'Atbash':
              chain.append(atbash);
            break;
            case 'Pizzini':
              chain.append(pizzini);
            break;
            case 'Polibio':
              chain.append(polibio);
            break;
            case 'Vigenere':
              chain.append(vigenere);
            break;
          }
        });

        $('.select').range({ from: 1, to: 26, step: 1 });
        $('.select').selectpicker({
                size: 5,
               style: 'btn-outline-danger',
          dropupAuto: false,
        }).selectpicker('val', '3');

        $(PLACEHOLDER).prev().on('keyup', function(e) {
          var text = $(this).val();
          var keyPressed  = e.key;

          switch (keyPressed) {
            case 'Shift':
            case 'Alt':
            case 'AltGraph':
            case 'CapsLock':
            case 'Control':
            case 'Fn':
            case 'FnLock':
            case 'Alt':
            case 'Hyper':
            case 'Meta':
            case 'NumLock':
            case 'ScrollLock':
            case 'Super':
            case 'OS':
            case 'Symbol':
            case 'SymbolLock':
            case 'Tab':
            case 'ArrowUp':
            case 'ArrowLeft':
            case 'ArrowDown':
            case 'ArrowRight':
            case 'PageUp':
            case 'PageDown':
            case 'End':
            case 'Home':
            break;
            default:
              if ($('#buttonCriptDecript > span').text() === 'Cripta') {
                outputText = text;
                chain.each(function() {
                  if (this.name === 'Vigenere') {
                    var vigenereKey = this.utils.lengthenKey($('.input-select').val());
                    outputText = [].map.call(outputText, function(ch, index) {
                      return this.encrypter(ch, vigenereKey[index]);
                    });
                  } else {
                    var caesarKey = $('select').val();
                    outputText = [].map.call(outputText, function(ch) {
                      return this.encrypter(ch, caesarKey);
                    });
                  }
                });

                output.text(outputText);
              }
              else {
                outputText = text;
                chain.each(function() {
                  if (this.name === 'Vigenere') {
                    var vigenereKey = this.utils.lengthenKey($('.input-select').val());
                    outputText = [].map.call(outputText, function(ch, index) {
                      return this.decrypter(ch, vigenereKey[index]);
                    });
                  } else {
                    var caesarKey = $('select').val();
                    outputText = [].map.call(outputText, function(ch) {
                      return this.decrypter(ch, polibioKey);
                    });
                  }
                });

                output.text(outputText);
              }
          }
        });

        // Run prettify.js
        PR.prettyPrint();

        //footer
        $('.footer-link').click(function() {
          $('html, body').animate({
            scrollTop: $('#top').offset().top-76
          }, 1200);
        });
      });
    </script>
  </body>
</html>
